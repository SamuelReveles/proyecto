"use strict";(self.webpackChunkjopaka=self.webpackChunkjopaka||[]).push([[288],{6288:(N,f,u)=>{u.r(f),u.d(f,{AuthModule:()=>j});var v=u(9808),P=u(520),_=u(3075),h=u(1083),a=u(5e3);let y=(()=>{class i{constructor(){}ngOnInit(){}}return i.\u0275fac=function(e){return new(e||i)},i.\u0275cmp=a.Xpm({type:i,selectors:[["app-main"]],decls:2,vars:0,template:function(e,t){1&e&&(a.TgZ(0,"body"),a._UZ(1,"router-outlet"),a.qZA())},directives:[h.lC],styles:["*[_ngcontent-%COMP%]{margin:0;padding:0;box-sizing:border-box;font-family:Poppins,sans-serif}body[_ngcontent-%COMP%]{height:100vh;display:flex;justify-content:center;align-items:center;background:url(Imagen4.2f409f4410dbbe3f.png);background-repeat:no-repeat;background-position-x:center;background-position-y:center;background-size:cover}"]}),i})();var L=u(5861),k=u(2340),S=u(87);const U=[{path:"",component:y,children:[{path:"login",component:(()=>{class i{constructor(e,t,o){this.router=e,this.usuarioService=t,this.ngZone=o,this.headers=new Headers,this.baseUrl=k.N.baseUrl}ngOnInit(){this.renderButton()}renderButton(){gapi.signin2.render("my-signin2",{scope:"profile email",width:270,height:50,longtitle:!0,theme:"dark"}),this.startApp()}startApp(){var e=this;return(0,L.Z)(function*(){yield e.usuarioService.googleInit(),e.auth2=e.usuarioService.auth2,e.attachSignin(document.getElementById("my-signin2"))})()}attachSignin(e){this.auth2.attachClickHandler(e,{},t=>{this.id_token=t.getAuthResponse().id_token,this.handleCredentialResponse(this.id_token)})}handleCredentialResponse(e){fetch(`${this.baseUrl}/auth/logIn`,{method:"post",headers:{"Content-Type":"application/json"},body:JSON.stringify({id_token:e})}).then(s=>s.json()).then(s=>{localStorage.setItem("token",s.jwt),!1!==s.success&&(localStorage.setItem("role",s.tipo),this.ngZone.run("Administrador"===s.tipo?()=>this.router.navigateByUrl("/Jopaka/administrador"):"Nutri\xf3logo"===s.tipo?()=>this.router.navigateByUrl("/Jopaka/nutriologo"):"Cliente"===s.tipo?()=>this.router.navigateByUrl("/Jopaka/cliente/inicio"):()=>this.router.navigateByUrl("/jopaka")))}).catch(s=>console.warn)}}return i.\u0275fac=function(e){return new(e||i)(a.Y36(h.F0),a.Y36(S.i),a.Y36(a.R0b))},i.\u0275cmp=a.Xpm({type:i,selectors:[["app-login"]],decls:16,vars:0,consts:[[1,"container"],[1,"logo"],["routerLink","../../jopaka"],["src","assets/img/logo.png","alt",""],[1,"title"],[1,"mensaje"],[1,"btnGoogle"],["id","my-signin2"],[1,"redRegistro"],["routerLink","../registro/"]],template:function(e,t){1&e&&(a.TgZ(0,"div",0)(1,"div",1)(2,"a",2),a._UZ(3,"img",3),a.qZA()(),a.TgZ(4,"div",4)(5,"p"),a._uU(6,"Inicia sesi\xf3n para ver m\xe1s"),a.qZA()(),a.TgZ(7,"div",5),a._uU(8," Accede a tu cuenta y ten las consultas con los nutri\xf3logos de tu preferencia "),a.qZA(),a.TgZ(9,"div",6),a._UZ(10,"div",7),a.qZA(),a.TgZ(11,"div",8)(12,"p"),a._uU(13,"\xbfA\xfan no tienes cuenta?"),a.qZA(),a.TgZ(14,"a",9),a._uU(15,"Crea una aqu\xed"),a.qZA()()())},directives:[h.yS],styles:["*[_ngcontent-%COMP%]{text-align:center}.container[_ngcontent-%COMP%]{max-width:600px;width:400px;margin:15px;background-color:#fff;padding:25px 30px;border-radius:10px;box-shadow:10px 10px 20px #aaa}.logo[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:125px;height:auto}.title[_ngcontent-%COMP%]{width:75%;margin:20px auto}.title[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-weight:600;font-size:27px}.redRegistro[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-style:italic}.redRegistro[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{color:#0087a2}.mensaje[_ngcontent-%COMP%]{font-size:15px;width:90%;margin:0 auto}.btnGoogle[_ngcontent-%COMP%]{height:175px;display:flex;align-items:center;justify-content:center}"]}),i})()},{path:"registro",loadChildren:()=>u.e(922).then(u.bind(u,5922)).then(i=>i.RegistroModule)},{path:"**",redirectTo:"login"}]}];let T=(()=>{class i{}return i.\u0275fac=function(e){return new(e||i)},i.\u0275mod=a.oAB({type:i}),i.\u0275inj=a.cJS({imports:[[h.Bz.forChild(U)],h.Bz]}),i})();var R=u(7579),A=u(6063);class b extends R.x{constructor(n=1/0,e=1/0,t=A.l){super(),this._bufferSize=n,this._windowTime=e,this._timestampProvider=t,this._buffer=[],this._infiniteTimeWindow=!0,this._infiniteTimeWindow=e===1/0,this._bufferSize=Math.max(1,n),this._windowTime=Math.max(1,e)}next(n){const{isStopped:e,_buffer:t,_infiniteTimeWindow:o,_timestampProvider:s,_windowTime:r}=this;e||(t.push(n),!o&&t.push(s.now()+r)),this._trimBuffer(),super.next(n)}_subscribe(n){this._throwIfClosed(),this._trimBuffer();const e=this._innerSubscribe(n),{_infiniteTimeWindow:t,_buffer:o}=this,s=o.slice();for(let r=0;r<s.length&&!n.closed;r+=t?1:2)n.next(s[r]);return this._checkFinalizedStatuses(n),e}_trimBuffer(){const{_bufferSize:n,_timestampProvider:e,_buffer:t,_infiniteTimeWindow:o}=this,s=(o?1:2)*n;if(n<1/0&&s<t.length&&t.splice(0,t.length-s),!o){const r=e.now();let l=0;for(let c=1;c<t.length&&t[c]<=r;c+=2)l=c;l&&t.splice(0,l+1)}}}class E extends R.x{constructor(){super(...arguments),this._value=null,this._hasValue=!1,this._isComplete=!1}_checkFinalizedStatuses(n){const{hasError:e,_hasValue:t,_value:o,thrownError:s,isStopped:r,_isComplete:l}=this;e?n.error(s):(r||l)&&(t&&n.next(o),n.complete())}next(n){this.isStopped||(this._value=n,this._hasValue=!0)}complete(){const{_hasValue:n,_value:e,_isComplete:t}=this;t||(this._isComplete=!0,n&&super.next(e),super.complete())}}class O{}let g=(()=>{class i extends class D{constructor(){}loadScript(n,e,t,o=null){if("undefined"!=typeof document&&!document.getElementById(n)){let s=document.createElement("script");s.async=!0,s.src=e,s.onload=t,o||(o=document.head),o.appendChild(s)}}}{constructor(e,t={scope:"email"}){super(),this.clientId=e,this.initOptions=t}initialize(){return new Promise((e,t)=>{try{this.loadScript(i.PROVIDER_ID,"https://apis.google.com/js/api.js",()=>{gapi.load("client:auth2",()=>{gapi.client.init(Object.assign(Object.assign({},this.initOptions),{client_id:this.clientId})).then(()=>{this.auth2=gapi.auth2.getAuthInstance(),e()}).catch(o=>{o.details.includes("deprecated")?(this.auth2=gapi.auth2.getAuthInstance(),console.error(o),e()):t(o)})})})}catch(o){t(o)}})}getLoginStatus(e){const t=Object.assign(Object.assign({},this.initOptions),e);return new Promise((o,s)=>{if(this.auth2.isSignedIn.get()){const r=new O,l=this.auth2.currentUser.get().getBasicProfile(),c=this.auth2.currentUser.get().getAuthResponse(!0);this.setUserProfile(r,l),r.response=c;const d=p=>{r.authToken=p.access_token,r.idToken=p.id_token,o(r)};t.refreshToken?this.auth2.currentUser.get().reloadAuthResponse().then(d):d(c)}else s(`No user is currently logged in with ${i.PROVIDER_ID}`)})}signIn(e){const t=Object.assign(Object.assign({},this.initOptions),e);return new Promise((o,s)=>{(t&&t.offline_access?this.auth2.grantOfflineAccess(e):this.auth2.signIn(e)).then(c=>{const d=new O;if(c&&c.code)d.authorizationCode=c.code;else{const p=this.auth2.currentUser.get().getBasicProfile(),m=this.auth2.currentUser.get().getAuthResponse(!0),C=m.access_token,z=m.id_token;this.setUserProfile(d,p),d.authToken=C,d.idToken=z,d.response=m}o(d)},c=>{s(c)}).catch(c=>{s(c)})})}signOut(e){return new Promise((t,o)=>{let s;s=e?this.auth2.disconnect():this.auth2.signOut(),s.then(r=>{r?o(r):t()}).catch(r=>{o(r)})})}setUserProfile(e,t){e.id=t.getId(),e.name=t.getName(),e.email=t.getEmail(),e.photoUrl=t.getImageUrl(),e.firstName=t.getGivenName(),e.lastName=t.getFamilyName()}}return i.PROVIDER_ID="GOOGLE",i})(),I=(()=>{class i{constructor(e){this.providers=new Map,this.autoLogin=!1,this._user=null,this._authState=new b(1),this.initialized=!1,this._initState=new E,e instanceof Promise?e.then(t=>{this.initialize(t)}):this.initialize(e)}get authState(){return this._authState.asObservable()}get initState(){return this._initState.asObservable()}initialize(e){this.autoLogin=void 0!==e.autoLogin&&e.autoLogin;const{onError:t=console.error}=e;e.providers.forEach(o=>{this.providers.set(o.id,o.provider)}),Promise.all(Array.from(this.providers.values()).map(o=>o.initialize())).then(()=>{if(this.autoLogin){const o=[];let s=!1;this.providers.forEach((r,l)=>{let c=r.getLoginStatus();o.push(c),c.then(d=>{d.provider=l,this._user=d,this._authState.next(d),s=!0}).catch(console.debug)}),Promise.all(o).catch(()=>{s||(this._user=null,this._authState.next(null))})}}).catch(o=>{t(o)}).finally(()=>{this.initialized=!0,this._initState.next(this.initialized),this._initState.complete()})}refreshAuthToken(e){return new Promise((t,o)=>{if(this.initialized)if(e!==g.PROVIDER_ID)o(i.ERR_NOT_SUPPORTED_FOR_REFRESH_TOKEN);else{const s=this.providers.get(e);s?s.getLoginStatus({refreshToken:!0}).then(r=>{r.provider=e,this._user=r,this._authState.next(r),t()}).catch(r=>{o(r)}):o(i.ERR_LOGIN_PROVIDER_NOT_FOUND)}else o(i.ERR_NOT_INITIALIZED)})}signIn(e,t){return new Promise((o,s)=>{if(this.initialized){let r=this.providers.get(e);r?r.signIn(t).then(l=>{l.provider=e,o(l),this._user=l,this._authState.next(l)}).catch(l=>{s(l)}):s(i.ERR_LOGIN_PROVIDER_NOT_FOUND)}else s(i.ERR_NOT_INITIALIZED)})}signOut(e=!1){return new Promise((t,o)=>{if(this.initialized)if(this._user){let r=this.providers.get(this._user.provider);r?r.signOut(e).then(()=>{t(),this._user=null,this._authState.next(null)}).catch(l=>{o(l)}):o(i.ERR_LOGIN_PROVIDER_NOT_FOUND)}else o(i.ERR_NOT_LOGGED_IN);else o(i.ERR_NOT_INITIALIZED)})}}return i.ERR_LOGIN_PROVIDER_NOT_FOUND="Login provider not found",i.ERR_NOT_LOGGED_IN="Not logged in",i.ERR_NOT_INITIALIZED="Login providers not ready yet. Are there errors on your console?",i.ERR_NOT_SUPPORTED_FOR_REFRESH_TOKEN="Chosen login provider is not supported for refreshing a token",i.\u0275fac=function(e){return new(e||i)(a.LFG("SocialAuthServiceConfig"))},i.\u0275prov=a.Yz7({token:i,factory:i.\u0275fac,providedIn:"root"}),i})(),w=(()=>{class i{constructor(e){if(e)throw new Error("SocialLoginModule is already loaded. Import it in the AppModule only")}static initialize(e){return{ngModule:i,providers:[I,{provide:"SocialAuthServiceConfig",useValue:e}]}}}return i.\u0275fac=function(e){return new(e||i)(a.LFG(i,12))},i.\u0275mod=a.oAB({type:i}),i.\u0275inj=a.cJS({providers:[I],imports:[[v.ez]]}),i})();var M=u(5090);let j=(()=>{class i{}return i.\u0275fac=function(e){return new(e||i)},i.\u0275mod=a.oAB({type:i}),i.\u0275inj=a.cJS({providers:[{provide:"SocialAuthServiceConfig",useValue:{autoLogin:!1,providers:[{id:g.PROVIDER_ID,provider:new g("clientId")}],onError:n=>{console.error(n)}}}],imports:[[T,v.ez,P.JF,M.q,w,_.UX]]}),i})()}}]);