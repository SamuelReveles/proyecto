"use strict";(self.webpackChunkjopaka=self.webpackChunkjopaka||[]).push([[288],{6288:(z,f,u)=>{u.r(f),u.d(f,{AuthModule:()=>M});var v=u(9808),_=u(520),P=u(3075),h=u(1083),a=u(5e3);let y=(()=>{class o{constructor(){}ngOnInit(){}}return o.\u0275fac=function(e){return new(e||o)},o.\u0275cmp=a.Xpm({type:o,selectors:[["app-main"]],decls:2,vars:0,template:function(e,t){1&e&&(a.TgZ(0,"body"),a._UZ(1,"router-outlet"),a.qZA())},directives:[h.lC],styles:["*[_ngcontent-%COMP%]{margin:0;padding:0;box-sizing:border-box;font-family:Poppins,sans-serif}body[_ngcontent-%COMP%]{height:100vh;display:flex;justify-content:center;align-items:center;background:url(Imagen4.2f409f4410dbbe3f.png);background-repeat:no-repeat;background-position-x:center;background-position-y:center;background-size:cover}"]}),o})();var L=u(5861),k=u(87);const S=[{path:"",component:y,children:[{path:"login",component:(()=>{class o{constructor(e,t,i){this.router=e,this.usuarioService=t,this.ngZone=i,this.headers=new Headers}ngOnInit(){this.renderButton()}renderButton(){gapi.signin2.render("my-signin2",{scope:"profile email",width:270,height:50,longtitle:!0,theme:"dark"}),this.startApp()}startApp(){var e=this;return(0,L.Z)(function*(){yield e.usuarioService.googleInit(),e.auth2=e.usuarioService.auth2,e.attachSignin(document.getElementById("my-signin2"))})()}attachSignin(e){this.auth2.attachClickHandler(e,{},t=>{this.id_token=t.getAuthResponse().id_token,this.handleCredentialResponse(this.id_token)})}handleCredentialResponse(e){fetch("http://localhost:8080/api/auth/logIn",{method:"post",headers:{"Content-Type":"application/json"},body:JSON.stringify({id_token:e})}).then(i=>i.json()).then(i=>{localStorage.setItem("token",i.jwt),!1!==i.success&&(localStorage.setItem("role",i.tipo),this.ngZone.run("Administrador"===i.tipo?()=>this.router.navigateByUrl("/Jopaka/administrador"):"Nutri\xf3logo"===i.tipo?()=>this.router.navigateByUrl("/Jopaka/nutriologo"):"Cliente"===i.tipo?()=>this.router.navigateByUrl("/Jopaka/cliente/inicio"):()=>this.router.navigateByUrl("/jopaka")))}).catch(i=>console.warn)}}return o.\u0275fac=function(e){return new(e||o)(a.Y36(h.F0),a.Y36(k.i),a.Y36(a.R0b))},o.\u0275cmp=a.Xpm({type:o,selectors:[["app-login"]],decls:16,vars:0,consts:[[1,"container"],[1,"logo"],["routerLink","../../jopaka"],["src","assets/img/logo.png","alt",""],[1,"title"],[1,"mensaje"],[1,"btnGoogle"],["id","my-signin2"],[1,"redRegistro"],["routerLink","../registro/"]],template:function(e,t){1&e&&(a.TgZ(0,"div",0)(1,"div",1)(2,"a",2),a._UZ(3,"img",3),a.qZA()(),a.TgZ(4,"div",4)(5,"p"),a._uU(6,"Inicia sesi\xf3n para ver m\xe1s"),a.qZA()(),a.TgZ(7,"div",5),a._uU(8," Accede a tu cuenta y ten las consultas con los nutri\xf3logos de tu preferencia "),a.qZA(),a.TgZ(9,"div",6),a._UZ(10,"div",7),a.qZA(),a.TgZ(11,"div",8)(12,"p"),a._uU(13,"\xbfA\xfan no tienes cuenta?"),a.qZA(),a.TgZ(14,"a",9),a._uU(15,"Crea una aqu\xed"),a.qZA()()())},directives:[h.yS],styles:["*[_ngcontent-%COMP%]{text-align:center}.container[_ngcontent-%COMP%]{max-width:600px;width:400px;margin:15px;background-color:#fff;padding:25px 30px;border-radius:10px;box-shadow:10px 10px 20px #aaa}.logo[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:125px;height:auto}.title[_ngcontent-%COMP%]{width:75%;margin:20px auto}.title[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-weight:600;font-size:27px}.redRegistro[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-style:italic}.redRegistro[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{color:#0087a2}.mensaje[_ngcontent-%COMP%]{font-size:15px;width:90%;margin:0 auto}.btnGoogle[_ngcontent-%COMP%]{height:175px;display:flex;align-items:center;justify-content:center}"]}),o})()},{path:"registro",loadChildren:()=>u.e(922).then(u.bind(u,5922)).then(o=>o.RegistroModule)},{path:"**",redirectTo:"login"}]}];let T=(()=>{class o{}return o.\u0275fac=function(e){return new(e||o)},o.\u0275mod=a.oAB({type:o}),o.\u0275inj=a.cJS({imports:[[h.Bz.forChild(S)],h.Bz]}),o})();var R=u(7579),A=u(6063);class U extends R.x{constructor(n=1/0,e=1/0,t=A.l){super(),this._bufferSize=n,this._windowTime=e,this._timestampProvider=t,this._buffer=[],this._infiniteTimeWindow=!0,this._infiniteTimeWindow=e===1/0,this._bufferSize=Math.max(1,n),this._windowTime=Math.max(1,e)}next(n){const{isStopped:e,_buffer:t,_infiniteTimeWindow:i,_timestampProvider:s,_windowTime:r}=this;e||(t.push(n),!i&&t.push(s.now()+r)),this._trimBuffer(),super.next(n)}_subscribe(n){this._throwIfClosed(),this._trimBuffer();const e=this._innerSubscribe(n),{_infiniteTimeWindow:t,_buffer:i}=this,s=i.slice();for(let r=0;r<s.length&&!n.closed;r+=t?1:2)n.next(s[r]);return this._checkFinalizedStatuses(n),e}_trimBuffer(){const{_bufferSize:n,_timestampProvider:e,_buffer:t,_infiniteTimeWindow:i}=this,s=(i?1:2)*n;if(n<1/0&&s<t.length&&t.splice(0,t.length-s),!i){const r=e.now();let l=0;for(let c=1;c<t.length&&t[c]<=r;c+=2)l=c;l&&t.splice(0,l+1)}}}class E extends R.x{constructor(){super(...arguments),this._value=null,this._hasValue=!1,this._isComplete=!1}_checkFinalizedStatuses(n){const{hasError:e,_hasValue:t,_value:i,thrownError:s,isStopped:r,_isComplete:l}=this;e?n.error(s):(r||l)&&(t&&n.next(i),n.complete())}next(n){this.isStopped||(this._value=n,this._hasValue=!0)}complete(){const{_hasValue:n,_value:e,_isComplete:t}=this;t||(this._isComplete=!0,n&&super.next(e),super.complete())}}class O{}let g=(()=>{class o extends class w{constructor(){}loadScript(n,e,t,i=null){if("undefined"!=typeof document&&!document.getElementById(n)){let s=document.createElement("script");s.async=!0,s.src=e,s.onload=t,i||(i=document.head),i.appendChild(s)}}}{constructor(e,t={scope:"email"}){super(),this.clientId=e,this.initOptions=t}initialize(){return new Promise((e,t)=>{try{this.loadScript(o.PROVIDER_ID,"https://apis.google.com/js/api.js",()=>{gapi.load("client:auth2",()=>{gapi.client.init(Object.assign(Object.assign({},this.initOptions),{client_id:this.clientId})).then(()=>{this.auth2=gapi.auth2.getAuthInstance(),e()}).catch(i=>{i.details.includes("deprecated")?(this.auth2=gapi.auth2.getAuthInstance(),console.error(i),e()):t(i)})})})}catch(i){t(i)}})}getLoginStatus(e){const t=Object.assign(Object.assign({},this.initOptions),e);return new Promise((i,s)=>{if(this.auth2.isSignedIn.get()){const r=new O,l=this.auth2.currentUser.get().getBasicProfile(),c=this.auth2.currentUser.get().getAuthResponse(!0);this.setUserProfile(r,l),r.response=c;const d=p=>{r.authToken=p.access_token,r.idToken=p.id_token,i(r)};t.refreshToken?this.auth2.currentUser.get().reloadAuthResponse().then(d):d(c)}else s(`No user is currently logged in with ${o.PROVIDER_ID}`)})}signIn(e){const t=Object.assign(Object.assign({},this.initOptions),e);return new Promise((i,s)=>{(t&&t.offline_access?this.auth2.grantOfflineAccess(e):this.auth2.signIn(e)).then(c=>{const d=new O;if(c&&c.code)d.authorizationCode=c.code;else{const p=this.auth2.currentUser.get().getBasicProfile(),m=this.auth2.currentUser.get().getAuthResponse(!0),j=m.access_token,C=m.id_token;this.setUserProfile(d,p),d.authToken=j,d.idToken=C,d.response=m}i(d)},c=>{s(c)}).catch(c=>{s(c)})})}signOut(e){return new Promise((t,i)=>{let s;s=e?this.auth2.disconnect():this.auth2.signOut(),s.then(r=>{r?i(r):t()}).catch(r=>{i(r)})})}setUserProfile(e,t){e.id=t.getId(),e.name=t.getName(),e.email=t.getEmail(),e.photoUrl=t.getImageUrl(),e.firstName=t.getGivenName(),e.lastName=t.getFamilyName()}}return o.PROVIDER_ID="GOOGLE",o})(),I=(()=>{class o{constructor(e){this.providers=new Map,this.autoLogin=!1,this._user=null,this._authState=new U(1),this.initialized=!1,this._initState=new E,e instanceof Promise?e.then(t=>{this.initialize(t)}):this.initialize(e)}get authState(){return this._authState.asObservable()}get initState(){return this._initState.asObservable()}initialize(e){this.autoLogin=void 0!==e.autoLogin&&e.autoLogin;const{onError:t=console.error}=e;e.providers.forEach(i=>{this.providers.set(i.id,i.provider)}),Promise.all(Array.from(this.providers.values()).map(i=>i.initialize())).then(()=>{if(this.autoLogin){const i=[];let s=!1;this.providers.forEach((r,l)=>{let c=r.getLoginStatus();i.push(c),c.then(d=>{d.provider=l,this._user=d,this._authState.next(d),s=!0}).catch(console.debug)}),Promise.all(i).catch(()=>{s||(this._user=null,this._authState.next(null))})}}).catch(i=>{t(i)}).finally(()=>{this.initialized=!0,this._initState.next(this.initialized),this._initState.complete()})}refreshAuthToken(e){return new Promise((t,i)=>{if(this.initialized)if(e!==g.PROVIDER_ID)i(o.ERR_NOT_SUPPORTED_FOR_REFRESH_TOKEN);else{const s=this.providers.get(e);s?s.getLoginStatus({refreshToken:!0}).then(r=>{r.provider=e,this._user=r,this._authState.next(r),t()}).catch(r=>{i(r)}):i(o.ERR_LOGIN_PROVIDER_NOT_FOUND)}else i(o.ERR_NOT_INITIALIZED)})}signIn(e,t){return new Promise((i,s)=>{if(this.initialized){let r=this.providers.get(e);r?r.signIn(t).then(l=>{l.provider=e,i(l),this._user=l,this._authState.next(l)}).catch(l=>{s(l)}):s(o.ERR_LOGIN_PROVIDER_NOT_FOUND)}else s(o.ERR_NOT_INITIALIZED)})}signOut(e=!1){return new Promise((t,i)=>{if(this.initialized)if(this._user){let r=this.providers.get(this._user.provider);r?r.signOut(e).then(()=>{t(),this._user=null,this._authState.next(null)}).catch(l=>{i(l)}):i(o.ERR_LOGIN_PROVIDER_NOT_FOUND)}else i(o.ERR_NOT_LOGGED_IN);else i(o.ERR_NOT_INITIALIZED)})}}return o.ERR_LOGIN_PROVIDER_NOT_FOUND="Login provider not found",o.ERR_NOT_LOGGED_IN="Not logged in",o.ERR_NOT_INITIALIZED="Login providers not ready yet. Are there errors on your console?",o.ERR_NOT_SUPPORTED_FOR_REFRESH_TOKEN="Chosen login provider is not supported for refreshing a token",o.\u0275fac=function(e){return new(e||o)(a.LFG("SocialAuthServiceConfig"))},o.\u0275prov=a.Yz7({token:o,factory:o.\u0275fac,providedIn:"root"}),o})(),D=(()=>{class o{constructor(e){if(e)throw new Error("SocialLoginModule is already loaded. Import it in the AppModule only")}static initialize(e){return{ngModule:o,providers:[I,{provide:"SocialAuthServiceConfig",useValue:e}]}}}return o.\u0275fac=function(e){return new(e||o)(a.LFG(o,12))},o.\u0275mod=a.oAB({type:o}),o.\u0275inj=a.cJS({providers:[I],imports:[[v.ez]]}),o})();var b=u(4353);let M=(()=>{class o{}return o.\u0275fac=function(e){return new(e||o)},o.\u0275mod=a.oAB({type:o}),o.\u0275inj=a.cJS({providers:[{provide:"SocialAuthServiceConfig",useValue:{autoLogin:!1,providers:[{id:g.PROVIDER_ID,provider:new g("clientId")}],onError:n=>{console.error(n)}}}],imports:[[T,v.ez,_.JF,b.q,D,P.UX]]}),o})()}}]);